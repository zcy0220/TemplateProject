/**
 * UIPrefab转代码
 */

using System.IO;
using System.Text;
using UnityEditor;
using UnityEngine;

namespace Editor.UIPrefabCodeGenerate
{
    public class UICodeGenerate
    {
        /// <summary>
        /// 代码导出路径
        /// </summary>
        public static string CODE_GENERATE_EXPORT_PATH = "Scripts/GameMain/Views/UI/AutoGenerated";

        /// <summary>
        /// 
        /// </summary>
        [MenuItem("Assets/UIPrefabCodeGenerate/CodeGenerate")]
        public static void Generate()
        {
            var sb = new StringBuilder();
            sb.Append(LineText("/**"));
            sb.Append(LineText(" * AutoGenerated Code By UICodeGenerate"));
            sb.Append(LineText(" */"));

            var prefab = Selection.activeObject as GameObject;
            var childs = prefab.transform.GetComponentsInChildren<Transform>(true);
            for (int i = 0; i < childs.Length; i++)
            {
            }

            var dirPath = Path.Combine(Application.dataPath, CODE_GENERATE_EXPORT_PATH);
            if (!Directory.Exists(dirPath)) Directory.CreateDirectory(dirPath);
            File.WriteAllText(Path.Combine(dirPath, $"{prefab.name}.cs"), sb.ToString());
            AssetDatabase.Refresh();
        }

        /// <summary>
        /// 获得每一行的字符串
        /// </summary>
        public static string LineText(string text, int tabCount = 0)
        {
            string result = "";
            for (int i = 1; i <= tabCount; i++)
            {
                result = "\t" + result;
            }
            return result + text + "\n";
        }
    }
}